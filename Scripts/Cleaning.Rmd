---
title: "Cleaning"
output: html_document
--- 
```{r setup}
# Load packages
library(dplyr)
library(ggplot2) 
library(readxl)

# Global options
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)

```

# Mortality Data 
## 1999-2013 
```{r importm99}
mortality99_13 <- read.csv("../RawData/cdph/2021-05-14_deaths_final_1999_2013_state_year_sup.csv")
```

First, we need to restrict the dataset to only observations with CA residents. We will do so by restricting the data to only cases where the `Geography_Type` column is "Residence", as per the data dictionary definition: 

**Whether the geography is based on the place of residence or place of occurrence. A geography type of Residence includes events for California residents even if they occurred outside of California, whereas a geography type of Occurrence includes events that occurred within California even if they were not California residents.** 

```{r residents}
table(mortality99_13$Geography_Type) 
mortality99_13 <- mortality99_13 %>% 
  filter(Geography_Type == "Residence")
```
There were the same count of occurrence and residence deaths. This makes sense, as there should be a row for each residence type and strata. After restricting the data, we have 2744 observations.  

Next, we are going to apply the exclusion criteria and recode the ICD codes into the same groups used in [Vaca et al. (2011)](https://pubmed.ncbi.nlm.nih.gov/21134905/): 

*"The ICD-10 underlying cause of death codes were grouped as follows: disease (001-294), motor vehicle (296-306), suicide (331-337), homicide (338-346), and all other injury (295, 307-330, 347-358). We restricted the data to three racial and ethnic groups: Latinos (defined as having Hispanic ethnicity and any race), non-Latino whites, and non-Latino blacks. We used race and ethnicity data recorded on the death certificate."* 

```{r}
mortality99_13
```

## 2014-2023
```{r importm14}
mortality14_23 <- read.csv("../RawData/cdph/20250116_deaths_final_2014_2023_state_year_sup.csv")
table(mortality14_23$Geography_Type) #checking counts of Residents/Non-Residents
```
# Population Data 

Next, we are going to import the Population Estimates from 2001-2025 from the DOF. There are 3 separate datasets we will need to clean and merge (2001-2010, 2011-2020, 2021-2025). 

### 2000-2010  

I was unable to locate an Intercensal estimate record that was statewide, just county-level. We will have to sum the values for corresponding Year, Race, Gender, and Age to get the state-level total. 

```{r dof1}
dof1 <- read.csv("../RawData/dof/Intercensal_2000-2010_DBInput_csv/Intercensal_2000-2010_DBInput_csv.txt") 
head(dof1) 

dof1_grouped <- dof1 %>% 
  group_by(Year, RaceCode, RaceName, Gender, Age) %>% 
  summarise(
    Population = sum(Population, na.rm = TRUE),
    .groups = "drop"
  )
head(dof1_grouped)
```
### 2010-2020 

```{r dof2}
dof2 <- read_excel("../RawData/dof/Intercensal_Excel_California.xlsx",
                   sheet = "California-State",
                   col_names = TRUE) 
dof2 <- dof2 %>% 
  select(Sex:"April 1, 2020") %>% 
  rename(age = "Age (0-100+)",
         race_eth = "Race/ethnicity recode") %>% 
  rename_with(tolower)
head(dof2) 

```
Each row contains the population count for a given age, race, and sex. We are going to tidy this data by making a new "Year" variable and "Population" variable to contain the values that are in wide format right now. 






We can organize each group to produce summary counts and make some graphs to explore the population distribution of each group. We also will need to combine ages to make the same age groups as those in the paper we are replicating. 

## 2021-2025
